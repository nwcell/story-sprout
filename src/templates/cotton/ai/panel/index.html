{% load humanize %}
<!-- AI Panel Component using direct store access -->
<div x-data>

  <div id="ai-panel"
       x-cloak
       x-show="$store.aiPanel"
       class="fixed bottom-0 left-0 md:left-64 right-0"
       :class="{ 'z-[30] pointer-events-auto': $store.aiPanel && $store.aiPanel.isOpen, 'z-auto pointer-events-none': !$store.aiPanel || !$store.aiPanel.isOpen }">

    <!-- Main Panel -->
    <div id="ai-panel-main"
         class="bg-white border-t border-light-gray flex flex-col transition-transform duration-500 ease-in-out"
         :class="{ 'translate-y-0': $store.aiPanel && $store.aiPanel.isOpen, 'translate-y-full': !$store.aiPanel || !$store.aiPanel.isOpen }">
      <div id="ai-panel-bar" class="p-2 border-b border-light-gray flex items-center justify-between">
        <h2 id="ai-panel-title" class="text-lg font-medium text-black">AI Panel Content</h2>
        <div class="flex items-center gap-2">
          <label for="ai-panel-filter-select" class="text-sm text-gray-500 whitespace-nowrap">Conversation:</label>
          <select id="ai-panel-filter-select" class="max-w-xs w-48 text-sm">
            {% for conversation in conversations %}
              <option value="conversation_uuid={{ conversation.uuid }}">{% if conversation.title %}{{ conversation.title }}{% else %}Started {{ conversation.created_at|naturaltime }}{% endif %}</option>
            {% endfor %}
          </select>
        </div>
        <c-button id="close-ai-panel"
                  icon="xmark"
                  class="hover:text-red-500"
                  @click="$store.aiPanel && $store.aiPanel.close()" />
      </div>
      <div id="ai-panel-body" sse-swap="ai-panel-content" class="p-2">
        <c-ai.panel.content :prompt=conversation.chat_display.message :chips=conversation.chat_display.chips />
      </div>
    </div>
  </div>

  <!-- Floating Tab (separate from panel to avoid blocking) -->
  <div x-cloak
       x-show="$store.aiPanel && !$store.aiPanel.isOpen"
       @click="$store.aiPanel && $store.aiPanel.open()"
       class="fixed bottom-0 right-2 z-[40]">
    <div class="bg-white border-t border-l border-r border-light-gray rounded-t-lg cursor-pointer hover:bg-gray-50 transition-all duration-500 ease-in-out px-4 py-2"
         role="button" aria-label="Open AI panel">
      <c-button icon="wand-magic-sparkles"
                class="text-purple-600 hover:text-purple-700 text-2xl" />
    </div>
  </div>
</div>
