{% load static %}
{# Combined editable field template with both display and edit modes #}
{% if mode == 'edit' %}
    {# Edit Mode #}
    <form hx-post="{{ url }}"
          hx-target="this"
          hx-swap="outerHTML"
          hx-trigger="submit, keydown[metaKey&&key=='Enter'] from:body, keydown[ctrlKey&&key=='Enter'] from:body, blur from:textarea"
          class="hover:bg-gray-50 p-2 rounded transition-colors">
        <h3 class="text-lg font-medium text-black mb-2">{{ label }}</h3>
        <div class="flex items-start space-x-2">
            <textarea name="{{ field_name }}" 
                      rows="4"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray resize-none flex-grow"
                      placeholder="{{ placeholder }}"
                      x-init="$el.focus()">{{ value }}</textarea>

            <!-- Button Group -->
            <span class="isolate inline-flex flex-col rounded-md shadow-sm">
                <c-buttons.save></c-buttons.save>
                <c-buttons.cancel url="{{ url }}"></c-buttons.cancel>
            </span>
            {% if form.errors %}
            <div class="text-red-500 text-sm mt-1">{{ form.errors }}</div>
            {% endif %}
        </div>
        <div class="text-xs text-gray-500 mt-1">Ctrl+Enter to save, Escape to cancel, or use the buttons.</div>
    </form>
{% else %}
{# Display Mode #}
<div hx-get="{{ url }}?mode=edit"
         hx-trigger="click"
         hx-target="this"
         hx-swap="outerHTML"
         class="cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors group">
        <h3 class="text-lg font-medium text-black">
            {{ label }}
            <i class="fa-solid fa-pen-to-square text-sm text-gray-400 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </h3>
        <div class="prose max-w-none group ">
            {% if slot %}
                <span class="whitespace-pre-line">{{ slot }}</span>
            {% else %}
                <p class="text-gray-400 italic">{{ placeholder }}</p>
            {% endif %}
        </div>
    </div>
{% endif %}
