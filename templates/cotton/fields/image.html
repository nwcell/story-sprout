<c-vars image upload_url />

<div x-data="imageUpload({% if image %}true{% else %}false{% endif %})"
     class="image-upload bg-white mt-1 w-full relative text-gray-400 rounded-md shadow-sm cursor-pointer aspect-square {% if not image %}border-2 border-gray-200 border-dashed {% endif %}"
     {% if image %}style="background-image: url('{{ image.url }}'); background-size: cover; background-position: center;"{% endif %}
     @mouseenter="handleMouseEnter()"
     @mouseleave="handleMouseLeave()"
     {% if image %}image-url="{{ image.url }}"{% endif %}>
    <div x-ref="container" class="relative cursor-pointer h-full rounded-md">
        <input accept=".jpg,.jpeg,.png,.webp"
               type="file"
               name="file"
               class="absolute inset-0 z-50 w-full h-full p-0 m-0 outline-none opacity-0 cursor-pointer"
               x-ref="fileInput"
               @change="handleFileSelected()"
               @dragover="handleDragOver()"
               @dragleave="handleDragEnd()"
               @drop="handleDragEnd()"
               hx-post="{{ upload_url }}"
               hx-encoding="multipart/form-data"
               hx-trigger="change"
               hx-target="closest .image-upload"
               hx-swap="outerHTML"
               hx-indicator=".upload-indicator"
        />
        <div class="h-full px-4 flex flex-col items-center justify-center text-center cursor-pointer"
             :class="{
                'opacity-100 text-white': hasImage && (isDragging || isHovering),
                'opacity-0 text-white': hasImage && !isDragging && !isHovering,
                'text-black': !hasImage
             }">
            <i class="fa-solid fa-cloud-upload text-2xl"></i>
            <p class="text-sm"><span class="font-semibold">Click to upload</span> or drag and drop</p>
            <p class="text-xs mt-2">jpg, jpeg, png, webp</p>
            {% comment %} <p class="mt-2 text-gray-900" x-text="fileName"></p> {% endcomment %}
        </div>

        <!-- Loading indicator -->
        <div class="upload-indicator htmx-indicator absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-3 rounded-lg">
                <i class="fa-solid fa-spinner animate-spin text-blue-600 text-xl mr-2"></i>
                <span class="text-sm font-medium">Uploading...</span>
            </div>
        </div>
    </div>
</div>
