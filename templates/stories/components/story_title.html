{% load static %}

{# Combined story title template with both display and edit modes #}
{% if mode == 'edit' %}
    {# Edit Mode #}
    <form hx-post="{% url 'stories:editable_story_title' story.uuid %}"  
          hx-target="this"
          hx-swap="outerHTML"
          hx-trigger="submit, keyup[key=='Enter'] from:input, blur from:input">
        <div class="flex items-center space-x-2">
            <input name="title"
                   value="{{ form.title.value|default:story.title }}" 
                   class="w-full text-2xl font-medium uppercase tracking-wide p-2 border border-blue-400 rounded-lg outline-none"
                   x-init="$el.focus()"
                   placeholder="Enter story title...">
            
            <!-- Button Group -->
            <span class="isolate inline-flex rounded-md shadow-sm">
                <!-- Cancel Button -->
                <button type="button"
                        @mousedown.prevent
                        class="relative inline-flex items-center justify-center rounded-l-md bg-white p-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-red-50 hover:text-red-600 focus:z-10"
                        title="Cancel (Esc)"
                        hx-get="{% url 'stories:get_story_title' story.uuid %}"
                        hx-target="closest form"
                        hx-swap="outerHTML">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <!-- Save Button -->
                <button type="submit"
                        @mousedown.prevent
                        class="relative -ml-px inline-flex items-center justify-center rounded-r-md bg-white p-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-green-50 hover:text-green-600 focus:z-10"
                        title="Save (Enter)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </button>
            </span>
        </div>
        <div class="text-xs text-gray-500 mt-1">Enter to save, Escape to cancel, or use the buttons.</div>
        {% if form.title.errors %}
            <div class="text-red-500 text-sm mt-1">{{ form.title.errors }}</div>
        {% endif %}
    </form>
{% else %}
    {# Display Mode #}
    <div id="story-title" 
         hx-get="{% url 'stories:editable_story_title' story.uuid %}?mode=edit" 
         hx-trigger="click"
         hx-target="this"
         hx-swap="outerHTML"
         class="cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors">
        <h1 class="text-2xl font-medium uppercase tracking-wide group">
            {{ value|default:story.title }}
            <i class="fa-solid fa-pen-to-square text-sm text-gray-400 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </h1>
    </div>
{% endif %}
